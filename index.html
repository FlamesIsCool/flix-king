<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>cinefx — Movies & TV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0b0c" />
  <!-- Minimal favicon: C on pink circle -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3CradialGradient id='p' cx='50%25' cy='50%25' r='50%25'%3E%3Cstop stop-color='%23ff2e77'/%3E%3Cstop offset='1' stop-color='%23e41861'/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='32' cy='32' r='28' fill='url(%23p)'/%3E%3Ctext x='50%25' y='54%25' text-anchor='middle' font-size='30' font-family='Inter,Arial' fill='white' font-weight='900'%3EC%3C/text%3E%3C/svg%3E">
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://image.tmdb.org" crossorigin>

  <style>
    :root{
      --bg:#0b0b0c;         /* matte black */
      --bg2:#121213;        /* slightly lighter matte */
      --text:#f5f5f7;
      --muted:#b7b7c0;
      --pink:#ff2e77;       /* brand pink */
      --pink-2:#e41861;
      --card:#151516;
      --radius:14px;
      --shadow:0 10px 26px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family:"Inter", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: linear-gradient(180deg, var(--bg), var(--bg2) 100%);
      overflow-x:hidden;
    }

    /* Header */
    .nav{
      position:fixed; inset-inline:0; top:0; z-index:50;
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      padding:14px clamp(16px,6vw,56px);
      background:rgba(10,10,11,.75); border-bottom:1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(6px);
    }
    .brand{
      font-weight:900; letter-spacing:.6px; text-transform:uppercase;
      font-size: clamp(20px, 2.2vw, 28px);
    }
    .brand b{ color:var(--pink) }
    .nav-right{ display:flex; align-items:center; gap:12px }
    .search{ position:relative }
    .search input{
      width:clamp(220px, 30vw, 440px);
      padding:12px 44px 12px 16px;
      border-radius:999px; border:1px solid rgba(255,255,255,.08);
      background:#1a1a1c; color:var(--text); outline:none; font-weight:600;
      transition:.2s;
    }
    .search input:focus{ border-color:rgba(255,255,255,.18); box-shadow:0 0 0 5px rgba(255,46,119,.15) }
    .search .icon{ position:absolute; right:12px; top:50%; transform:translateY(-50%); opacity:.7 }

    /* Hero */
    .hero{
      position:relative; height:68vh; min-height:520px;
      display:grid; place-items:end start; padding: clamp(18px, 6vw, 64px);
      margin-top:72px; overflow:hidden; border-bottom:1px solid rgba(255,255,255,.06);
    }
    .hero-bg{ position:absolute; inset:0; background-position:center 30%; background-size:cover; filter:contrast(1.02) saturate(1.05); transform:scale(1.03) }
    .hero::after{ content:""; position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,.05), rgba(0,0,0,.6) 58%, var(--bg) 95%) }
    .hero-card{ position:relative; z-index:2; max-width:min(980px, 94vw) }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px; font-weight:800; font-size:.85rem;
      background:#1c1c1f; border:1px solid rgba(255,255,255,.10); color:#fff;
    }
    .hero-title{ font-size: clamp(30px, 5.2vw, 60px); font-weight:900; line-height:1.04; margin:10px 0 10px }
    .hero-overview{ max-width:820px; color:#e9e9ee; opacity:.92; line-height:1.55; font-weight:600; margin:0 0 16px }
    .actions{ display:flex; gap:12px; flex-wrap:wrap }
    .btn{
      display:inline-flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px;
      padding:14px 22px; border-radius:12px; border:1px solid transparent; cursor:pointer; transition:.2s; box-shadow:var(--shadow)
    }
    .btn-primary{ background:linear-gradient(90deg, var(--pink), var(--pink-2)); color:#fff }
    .btn-primary:hover{ filter:brightness(.96) }
    .btn-ghost{ background:#1b1b1d; color:#fff; border-color:rgba(255,255,255,.10) }
    .btn-ghost:hover{ background:#222226 }

    /* Sections */
    .section{ padding:28px clamp(16px,6vw,56px) }
    .section h2{ font-size: clamp(20px, 2.2vw, 28px); font-weight:900; letter-spacing:.4px; margin:6px 0 14px }
    .rail-inner{ display:flex; gap:14px; overflow-x:auto; padding:6px 2px; scroll-behavior:smooth }
    .rail-inner::-webkit-scrollbar{ height:10px } .rail-inner::-webkit-scrollbar-thumb{ background:rgba(255,255,255,.12); border-radius:999px }

    .card{
      position:relative; min-width:168px; max-width:168px; aspect-ratio:2/3;
      border-radius:14px; overflow:hidden; background:#1a1a1c;
      box-shadow:0 18px 40px rgba(0,0,0,.38); cursor:pointer; transition:.2s;
    }
    .card:hover{ transform:translateY(-4px); box-shadow:0 26px 60px rgba(0,0,0,.55) }
    .poster{ width:100%; height:100%; object-fit:cover; display:block }
    .card-info{ position:absolute; inset:auto 0 0 0; background:linear-gradient(180deg, transparent, rgba(0,0,0,.92));
      padding:10px 12px }
    .card-title{ font-weight:900; font-size:1rem; line-height:1.2; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden }
    .pill{ display:inline-block; margin-top:6px; padding:4px 8px; border-radius:999px; font-weight:800; font-size:.85rem; background:#1c1c1f; border:1px solid rgba(255,255,255,.10) }

    /* Search */
    .search-wrap{ padding:10px clamp(16px,6vw,56px) 0 }
    .results{ display:grid; grid-template-columns:repeat(auto-fill, minmax(160px,1fr)); gap:16px; margin-bottom:26px }
    .result-card{ background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:14px; overflow:hidden; cursor:pointer; transition:.2s }
    .result-card:hover{ transform:translateY(-4px) }
    .result-img{ width:100%; aspect-ratio:2/3; object-fit:cover }
    .result-meta{ padding:10px 12px }
    .result-title{ font-weight:900 }
    .result-sub{ color:var(--muted); font-weight:700; font-size:.88rem }

    /* Continue Watching */
    #continueSection{ display:none }
    .progressbar{ height:4px; background:#2a2a2c; border-radius:999px; overflow:hidden; margin-top:6px }
    .progressbar>div{ height:100%; background:linear-gradient(90deg, var(--pink), var(--pink-2)); width:0% }

    /* Skeletons */
    .skeleton{ background:linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.12), rgba(255,255,255,.06)); background-size:200% 100%; animation:shimmer 1.6s infinite linear }
    @keyframes shimmer{ 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    .sk-card{ min-width:168px; max-width:168px; aspect-ratio:2/3; border-radius:14px }
    @media (max-width:740px){ .hero-overview{ display:none } }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="brand">cine<b>fx</b></div>
    <div class="nav-right">
      <div class="search">
        <input id="searchInput" placeholder="Search movies or shows…" />
        <span class="icon">⌕</span>
      </div>
    </div>
  </nav>

  <section class="hero">
    <div id="heroBg" class="hero-bg"></div>
    <div class="hero-card">
      <div class="badge" id="heroType">FEATURED</div>
      <h1 class="hero-title" id="heroTitle">Loading…</h1>
      <p class="hero-overview" id="heroOverview"></p>
      <div class="actions">
        <button class="btn btn-primary" id="playBtn">▶ Play</button>
        <button class="btn btn-ghost" id="moreBtn">Details</button>
      </div>
    </div>
  </section>

  <div class="search-wrap" id="searchWrap" style="display:none">
    <h2 style="font-weight:900">Search Results</h2>
    <div id="results" class="results"></div>
  </div>

  <section class="section" id="continueSection">
    <h2>Continue Watching</h2>
    <div class="rail"><div id="continueRail" class="rail-inner"></div></div>
  </section>

  <section class="section"><h2>Trending Now</h2><div class="rail"><div id="row1" class="rail-inner"><div class="sk-card skeleton"></div><div class="sk-card skeleton"></div><div class="sk-card skeleton"></div></div></div></section>
  <section class="section"><h2>Top Rated</h2><div class="rail"><div id="row2" class="rail-inner"></div></div></section>
  <section class="section"><h2>Action</h2><div class="rail"><div id="row3" class="rail-inner"></div></div></section>
  <section class="section"><h2>Comedy</h2><div class="rail"><div id="row4" class="rail-inner"></div></div></section>
  <section class="section"><h2>Popular TV</h2><div class="rail"><div id="row5" class="rail-inner"></div></div></section>

  <script>
    /* ===== CONFIG ===== */
    const API_KEY = "d9f0568167a608d0700093444b0c2da7";
    const IMG = { w500:"https://image.tmdb.org/t/p/w500", original:"https://image.tmdb.org/t/p/original" };
    const endpoints = {
      trending:`https://api.themoviedb.org/3/trending/all/week?include_adult=false&api_key=${API_KEY}`,
      topRated:`https://api.themoviedb.org/3/movie/top_rated?api_key=${API_KEY}`,
      action:`https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&with_genres=28`,
      comedy:`https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&with_genres=35`,
      tvPopular:`https://api.themoviedb.org/3/tv/popular?api_key=${API_KEY}`
    };

    /* ===== DOM ===== */
    const heroBg = document.getElementById("heroBg");
    const heroTitle = document.getElementById("heroTitle");
    const heroOverview = document.getElementById("heroOverview");
    const heroType = document.getElementById("heroType");
    const playBtn = document.getElementById("playBtn");
    const moreBtn = document.getElementById("moreBtn");

    const row1 = document.getElementById("row1");
    const row2 = document.getElementById("row2");
    const row3 = document.getElementById("row3");
    const row4 = document.getElementById("row4");
    const row5 = document.getElementById("row5");

    const searchInput = document.getElementById("searchInput");
    const searchWrap = document.getElementById("searchWrap");
    const results = document.getElementById("results");

    const continueSection = document.getElementById("continueSection");
    const continueRail = document.getElementById("continueRail");

    /* ===== UTIL ===== */
    const yearOf = d => (d||"").split("-")[0]||"";
    const truncate = (t,n=240)=> t&&t.length>n ? t.slice(0,n).trim()+"…" : (t||"");
    const goWatch = (id,type,season,episode)=>{
      const s = season?`&season=${season}`:"";
      const e = episode?`&episode=${episode}`:"";
      location.href = `watch.html?id=${id}&type=${type}${s}${e}&play=true`;
    };

    function card(item, forceTv=false, progress=0){
      const type = forceTv ? "tv" : (item.media_type==="tv" ? "tv" : "movie");
      const title = item.title || item.name;
      const poster = item.poster_path || item.backdrop_path;
      const el = document.createElement("div");
      el.className = "card";
      el.innerHTML = `
        <img class="poster" loading="lazy" src="${IMG.w500 + poster}" alt="${title}">
        <div class="card-info">
          <div class="card-title">${title}</div>
          <span class="pill">${type.toUpperCase()}</span>
          ${progress ? `<div class="progressbar"><div style="width:${Math.round(progress)}%"></div></div>` : ""}
        </div>`;
      el.addEventListener("click", ()=> goWatch(item.id, type));
      return el;
    }

    /* ===== HERO ===== */
    async function setHero(){
      const r = await fetch(endpoints.trending); const j = await r.json();
      const pick = (j.results||[]).find(x=>x.backdrop_path) || (j.results||[])[0];
      if(!pick) return;
      const item = {
        id: pick.id, type: pick.media_type==="tv" ? "tv" : "movie",
        title: pick.title || pick.name, overview: pick.overview,
        backdrop: pick.backdrop_path, date: pick.release_date || pick.first_air_date
      };
      heroBg.style.backgroundImage = `url(${IMG.original + item.backdrop})`;
      heroTitle.textContent = item.title;
      heroType.textContent = item.type==="tv" ? "TV SERIES" : "MOVIE";
      heroOverview.textContent = truncate(item.overview);
      playBtn.onclick = ()=> goWatch(item.id, item.type);
      moreBtn.onclick = ()=> alert("Open a title to play. TV picks open the first available episode.");
    }

    /* ===== ROWS ===== */
    async function fillRow(container, url, forceTv=false){
      const r = await fetch(url); const j = await r.json();
      container.innerHTML = "";
      (j.results||[]).filter(x=>x.poster_path||x.backdrop_path).forEach(item=>{
        container.appendChild(card(item, forceTv));
      });
    }

    /* ===== SEARCH (debounced) ===== */
    let t;
    searchInput.addEventListener("input", ()=>{
      clearTimeout(t);
      const q = searchInput.value.trim();
      if(!q){ searchWrap.style.display="none"; results.innerHTML=""; return; }
      t = setTimeout(()=> doSearch(q), 260);
    });
    async function doSearch(q){
      searchWrap.style.display="block"; results.innerHTML="";
      const r = await fetch(`https://api.themoviedb.org/3/search/multi?include_adult=false&api_key=${API_KEY}&query=${encodeURIComponent(q)}`);
      const j = await r.json();
      (j.results||[]).filter(x=>x.poster_path).forEach(item=>{
        const type = item.media_type==="tv" ? "tv" : "movie";
        const el = document.createElement("div");
        el.className = "result-card";
        el.innerHTML = `
          <img class="result-img" loading="lazy" src="${IMG.w500 + item.poster_path}" alt="${item.title||item.name}">
          <div class="result-meta">
            <div class="result-title">${item.title||item.name}</div>
            <div class="result-sub">${type.toUpperCase()} • ${(item.release_date||item.first_air_date||"").slice(0,4)}</div>
          </div>`;
        el.addEventListener("click", ()=> goWatch(item.id, type));
        results.appendChild(el);
      });
    }

    /* ===== CONTINUE WATCHING ===== */
    function getMap(){ try{return JSON.parse(localStorage.getItem("fk-continue")||"{}")}catch{return{}} }
    async function buildContinue(){
      const map = getMap();
      const keys = Object.keys(map).filter(k=> map[k] && map[k].progress < 98);
      if(!keys.length){ continueSection.style.display="none"; return; }
      continueSection.style.display="block";
      continueRail.innerHTML = "";
      for(const k of keys){
        const { id, type, progress } = map[k];
        try{
          const url = type==="tv" ? `https://api.themoviedb.org/3/tv/${id}?api_key=${API_KEY}` : `https://api.themoviedb.org/3/movie/${id}?api_key=${API_KEY}`;
          const d = await fetch(url).then(r=>r.json());
          if(d && (d.poster_path||d.backdrop_path)){
            const item = { id, media_type:type, title:d.title||d.name, poster_path:d.poster_path||d.backdrop_path };
            continueRail.appendChild(card(item, type==="tv", progress));
          }
        }catch{}
      }
    }

    (async function init(){
      await setHero();
      fillRow(row1, endpoints.trending);
      fillRow(row2, endpoints.topRated);
      fillRow(row3, endpoints.action);
      fillRow(row4, endpoints.comedy);
      fillRow(row5, endpoints.tvPopular, true);
      buildContinue();
    })();
  </script>
</body>
</html>