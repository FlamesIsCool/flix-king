<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FlixKing — Movies & TV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0b0b" />
  <!-- Favicon (inline SVG, gradient play icon) -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' x2='1' y1='0' y2='1'%3E%3Cstop stop-color='%23ff385c'/%3E%3Cstop stop-color='%23e50914' offset='1'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='256' height='256' rx='56' fill='%230b0b0b'/%3E%3Cpath d='M96 72l96 56-96 56z' fill='url(%23g)'/%3E%3C/svg%3E">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' x2='1' y1='0' y2='1'%3E%3Cstop stop-color='%23ff385c'/%3E%3Cstop stop-color='%23e50914' offset='1'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='256' height='256' rx='56' fill='%230b0b0b'/%3E%3Cpath d='M96 72l96 56-96 56z' fill='url(%23g)'/%3E%3C/svg%3E">
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400..900&display=swap" rel="stylesheet">
  <!-- Image CDN preconnect -->
  <link rel="preconnect" href="https://image.tmdb.org" crossorigin>
  <style>
    :root{
      --bg:#0b0b0b; --bg-2:#141414; --text:#ffffff; --muted:#b3b3b3;
      --accent:#e50914; --accent2:#ff385c; --card:#1a1a1a; --shadow:0 10px 30px rgba(0,0,0,.45);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: "Inter", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text); background: radial-gradient(1200px 800px at 10% -10%, #1e1e1e 0%, transparent 60%), linear-gradient(180deg, var(--bg), var(--bg-2));
      overflow-x:hidden;
    }
    /* animated background glow */
    body::before{
      content:""; position:fixed; inset:-40% -40% auto auto; width:80vmax; height:80vmax; border-radius:50%;
      background: radial-gradient(closest-side, rgba(229,9,20,.12), rgba(229,9,20,0));
      filter: blur(40px); z-index:-1; animation: drift 18s ease-in-out infinite alternate;
    }
    @keyframes drift{ from{ transform: translate(0,0) } to{ transform: translate(6%, -4%) } }

    /* HEADER */
    .nav{
      position:fixed; inset-inline:0; top:0; z-index:1000;
      padding:14px clamp(16px, 6vw, 56px);
      display:flex; align-items:center; gap:18px; justify-content:space-between;
      backdrop-filter: blur(10px);
      background:linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.25), transparent);
      border-bottom: 1px solid rgba(255,255,255,.05);
    }
    .brand{
      display:flex; align-items:center; gap:14px; font-weight:900; letter-spacing:.6px;
      font-size: clamp(22px, 2.4vw, 32px); line-height:1;
      background: linear-gradient(90deg, #fff, #ffeff2 30%, #ffd7dd 60%, #ffffff);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 0 24px rgba(255,255,255,.07);
    }
    .brand .dot{
      width:12px; height:12px; border-radius:50%;
      background: conic-gradient(from 0deg at 50% 50%, var(--accent), var(--accent2), var(--accent));
      box-shadow: 0 0 20px var(--accent), 0 0 44px rgba(229,9,20,.35);
      animation: pulse 1.6s infinite ease-in-out;
    }
    @keyframes pulse{ 0%,100%{ transform: scale(1)} 50%{ transform: scale(1.18)} }

    .nav-right{display:flex; align-items:center; gap:14px}
    .search{ position:relative }
    .search input{
      width:clamp(230px, 30vw, 440px);
      padding:12px 44px 12px 16px; border-radius:999px; border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.06); color:var(--text); outline:none;
      transition: box-shadow .25s, background .25s, border .25s;
      font-weight:600;
    }
    .search input:focus{
      border-color:rgba(255,255,255,.18);
      box-shadow:0 0 0 6px rgba(229,9,20,.18);
      background:rgba(255,255,255,.10);
    }
    .search .icon{
      position:absolute; right:12px; top:50%; transform:translateY(-50%);
      opacity:.7; font-size:18px; user-select:none;
    }

    /* HERO */
    .hero{
      position:relative; height:70vh; min-height:520px;
      display:grid; place-items:end start; padding: clamp(18px, 6vw, 64px);
      margin-top:72px; overflow:hidden; border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .hero-bg{ position:absolute; inset:0; background-position:center 30%; background-size:cover; filter:saturate(1.1) contrast(1.05); transform: scale(1.03) }
    .hero::after{ content:""; position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,.05), rgba(0,0,0,.55) 55%, var(--bg) 92%) }
    .hero-card{ position:relative; z-index:2; max-width: min(980px, 94vw); padding: clamp(12px, 2vw, 22px); border-radius: var(--radius) }
    .badge{ background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.12); padding:4px 10px; border-radius:999px; font-size:.85rem; font-weight:800 }
    .hero-title{ font-size: clamp(34px, 5.8vw, 66px); font-weight: 900; line-height: 1.03; margin: 6px 0 12px; text-shadow: 0 6px 30px rgba(0,0,0,.55) }
    .hero-meta{ display:flex; align-items:center; gap:10px; color:#e6e6e6; font-weight:700; letter-spacing:.3px; margin-bottom:12px }
    .hero-overview{ max-width: 820px; color:#ededed; opacity:.94; line-height:1.55; margin: 6px 0 18px; text-wrap: balance; font-weight:600 }
    .btn{
      display:inline-flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.3px;
      padding:14px 22px; border-radius:12px; border:1px solid transparent; cursor:pointer; transition:.25s; box-shadow: var(--shadow);
    }
    .btn-primary{ background:linear-gradient(90deg, var(--accent), var(--accent2)); color:#fff }
    .btn-primary:hover{ filter:brightness(.95) saturate(1.08) translateZ(0) }
    .btn-ghost{ background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.12); color:#fff }
    .btn-ghost:hover{ background:rgba(255,255,255,.14) }

    /* SECTION / ROWS */
    .section{ padding: 28px clamp(16px, 6vw, 56px) }
    .section h2{ font-size: clamp(22px, 2.4vw, 32px); margin: 6px 0 14px; font-weight:900; letter-spacing:.4px }
    .rail{ position:relative }
    .rail-inner{ display:flex; gap:14px; overflow-x:auto; scroll-behavior:smooth; padding: 6px 2px; scroll-snap-type: x proximity }
    .rail-inner::-webkit-scrollbar{ height:10px } .rail-inner::-webkit-scrollbar-thumb{ background:rgba(255,255,255,.12); border-radius:999px }

    .card{
      position:relative; min-width: 168px; max-width: 168px; aspect-ratio: 2/3;
      border-radius:14px; overflow:hidden; background:linear-gradient(180deg, #202020, #111);
      transform: translateZ(0); cursor:pointer; box-shadow: 0 20px 40px rgba(0,0,0,.35);
      transition: transform .25s, box-shadow .25s; scroll-snap-align:start;
      isolation:isolate;
    }
    .card:hover{ transform: translateY(-4px) scale(1.03); box-shadow: 0 28px 60px rgba(0,0,0,.55) }
    .card::after{
      content:""; position:absolute; inset:0; border-radius:inherit; z-index:1;
      background: radial-gradient(80% 50% at 50% 100%, rgba(229,9,20,.14), transparent 70%);
      opacity:0; transition:.25s;
    }
    .card:hover::after{ opacity:1 }
    .poster{ width:100%; height:100%; object-fit:cover; display:block }
    .card-info{ position:absolute; inset:auto 0 0 0; padding:10px 10px 12px; background: linear-gradient(180deg, transparent, rgba(0,0,0,.82) 55%, rgba(0,0,0,.92)); display:flex; flex-direction:column; gap:6px; z-index:2 }
    .card-title{ font-weight:900; font-size:.98rem; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical }
    .pill{ padding:3px 8px; border-radius:999px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.12); font-weight:800 }

    /* SEARCH RESULTS */
    .search-wrap{ padding: 10px clamp(16px, 6vw, 56px) 0 }
    .results{ margin: 10px 0 24px; display:grid; grid-template-columns:repeat(auto-fill, minmax(160px,1fr)); gap:16px }
    .result-card{ background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:14px; overflow:hidden; cursor:pointer; transition:.2s }
    .result-card:hover{ transform:translateY(-4px) }
    .result-img{ width:100%; aspect-ratio:2/3; object-fit:cover; display:block }
    .result-meta{ padding:10px 12px 12px }
    .result-title{ font-weight:900; font-size:1rem; margin:0 0 4px }
    .result-sub{ color:var(--muted); font-size:.88rem; font-weight:700 }

    /* CONTINUE WATCHING */
    #continueSection{ display:none }
    .progressbar{ height:4px; background:rgba(255,255,255,.2); border-radius:999px; overflow:hidden; margin-top:6px }
    .progressbar > div{ height:100%; background: linear-gradient(90deg, #ff7043, var(--accent)); width:0% }

    /* SKELETONS */
    .skeleton{ background:linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.12), rgba(255,255,255,.06)); background-size:200% 100%; animation:shimmer 1.6s infinite linear; }
    @keyframes shimmer{ 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    .sk-card{ min-width:168px; max-width:168px; aspect-ratio:2/3; border-radius:14px }

    /* REVEAL */
    .reveal{ opacity:0; transform: translateY(8px); transition:.5s }
    .reveal.show{ opacity:1; transform:none }

    @media (max-width: 720px){ .hero{ min-height:480px } .hero-overview{ display:none } }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="nav">
    <div class="brand"><span class="dot"></span> FLIXKING</div>
    <div class="nav-right">
      <div class="search">
        <input id="searchInput" placeholder="Search movies or shows…" />
        <span class="icon">⌕</span>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <section class="hero">
    <div id="heroBg" class="hero-bg"></div>
    <div class="hero-card">
      <div class="badge" id="heroType">FEATURED</div>
      <h1 class="hero-title" id="heroTitle">Loading…</h1>
      <div class="hero-meta">
        <span class="badge" id="heroYear">—</span>
        <span class="badge" id="heroRating">★ —</span>
      </div>
      <p class="hero-overview" id="heroOverview"></p>
      <div class="hero-actions">
        <button class="btn btn-primary" id="playBtn">▶ Play</button>
        <button class="btn btn-ghost" id="moreBtn">ℹ More Info</button>
      </div>
    </div>
  </section>

  <!-- SEARCH RESULTS -->
  <div class="search-wrap" id="searchWrap" style="display:none">
    <h2 style="font-weight:900;letter-spacing:.4px;">Search Results</h2>
    <div id="results" class="results"></div>
  </div>

  <!-- CONTINUE WATCHING -->
  <section class="section" id="continueSection">
    <h2>Continue Watching</h2>
    <div class="rail">
      <div id="continueRail" class="rail-inner"></div>
    </div>
  </section>

  <!-- ROWS -->
  <section class="section">
    <h2>Trending Now</h2>
    <div class="rail">
      <div id="row1" class="rail-inner">
        <div class="sk-card skeleton"></div><div class="sk-card skeleton"></div><div class="sk-card skeleton"></div>
      </div>
    </div>
  </section>
  <section class="section"><h2>Top Rated</h2><div class="rail"><div id="row2" class="rail-inner"></div></div></section>
  <section class="section"><h2>Action</h2><div class="rail"><div id="row3" class="rail-inner"></div></div></section>
  <section class="section"><h2>Comedy</h2><div class="rail"><div id="row4" class="rail-inner"></div></div></section>
  <section class="section"><h2>Popular TV</h2><div class="rail"><div id="row5" class="rail-inner"></div></div></section>

  <script>
    /* ===== CONFIG ===== */
    const API_KEY = "d9f0568167a608d0700093444b0c2da7"; // <- replace with your TMDB key
    const IMG = { w500:"https://image.tmdb.org/t/p/w500", original:"https://image.tmdb.org/t/p/original" };
    const endpoints = {
      trending:`https://api.themoviedb.org/3/trending/all/week?include_adult=false&api_key=${API_KEY}`,
      topRated:`https://api.themoviedb.org/3/movie/top_rated?api_key=${API_KEY}`,
      action:`https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&with_genres=28`,
      comedy:`https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&with_genres=35`,
      tvPopular:`https://api.themoviedb.org/3/tv/popular?api_key=${API_KEY}`
    };

    /* ===== DOM ===== */
    const heroBg = document.getElementById("heroBg");
    const heroTitle = document.getElementById("heroTitle");
    const heroOverview = document.getElementById("heroOverview");
    const heroType = document.getElementById("heroType");
    const heroYear = document.getElementById("heroYear");
    const heroRating = document.getElementById("heroRating");
    const playBtn = document.getElementById("playBtn");
    const moreBtn = document.getElementById("moreBtn");

    const row1 = document.getElementById("row1");
    const row2 = document.getElementById("row2");
    const row3 = document.getElementById("row3");
    const row4 = document.getElementById("row4");
    const row5 = document.getElementById("row5");

    const searchInput = document.getElementById("searchInput");
    const searchWrap = document.getElementById("searchWrap");
    const results = document.getElementById("results");

    const continueSection = document.getElementById("continueSection");
    const continueRail = document.getElementById("continueRail");

    let currentHero = null;

    /* ===== UTIL ===== */
    const yearOf = d => (d||"").split("-")[0]||"";
    const truncate = (t,n=240)=> t&&t.length>n ? t.slice(0,n).trim()+"…" : (t||"");
    const goWatch = (id,type,season,episode)=>{
      const s = season?`&season=${season}`:"";
      const e = episode?`&episode=${episode}`:"";
      location.href = `watch.html?id=${id}&type=${type}${s}${e}&play=true`;
    };
    const revealObserve = (root=document)=>{
      const io = new IntersectionObserver((entries)=>{
        for(const e of entries){ if(e.isIntersecting){ e.target.classList.add("show"); io.unobserve(e.target);} }
      }, {threshold:.18});
      root.querySelectorAll(".reveal").forEach(el=> io.observe(el));
    };

    function makeCard(item, forceTv=false, withProgress=0){
      const type = forceTv ? "tv" : (item.media_type==="tv" ? "tv" : "movie");
      const title = item.title || item.name;
      const poster = item.poster_path || item.backdrop_path;
      const div = document.createElement("div");
      div.className = "card reveal";
      div.innerHTML = `
        <img class="poster" loading="lazy" src="${IMG.w500 + poster}" alt="${title}">
        <div class="card-info">
          <div class="card-title">${title}</div>
          <div class="pill">${type.toUpperCase()}</div>
          ${withProgress ? `<div class="progressbar"><div style="width:${withProgress}%"></div></div>` : ""}
        </div>`;
      div.addEventListener("click", ()=> goWatch(item.id, type));
      return div;
    }

    /* ===== HERO ===== */
    async function setHero(){
      const r = await fetch(endpoints.trending); const j = await r.json();
      const pick = (j.results||[]).find(x=>x.backdrop_path) || (j.results||[])[0];
      if(!pick) return;
      currentHero = {
        id: pick.id, type: pick.media_type==="tv" ? "tv" : "movie",
        title: pick.title || pick.name, overview: pick.overview,
        backdrop: pick.backdrop_path, date: pick.release_date || pick.first_air_date,
        vote: pick.vote_average
      };
      heroBg.style.backgroundImage = `url(${IMG.original + currentHero.backdrop})`;
      heroTitle.textContent = currentHero.title;
      heroType.textContent = currentHero.type==="tv" ? "TV SERIES" : "MOVIE";
      heroYear.textContent = yearOf(currentHero.date) || "—";
      heroRating.textContent = "★ " + (Math.round((currentHero.vote||0)*10)/10);
      heroOverview.textContent = truncate(currentHero.overview);
      playBtn.onclick = ()=> goWatch(currentHero.id, currentHero.type);
      moreBtn.onclick = ()=> alert("Tip: Click any poster to play instantly.");
    }

    /* ===== ROWS ===== */
    async function fillRow(container, url, forceTv=false){
      const r = await fetch(url); const j = await r.json();
      container.innerHTML = "";
      (j.results||[]).filter(x=>x.poster_path||x.backdrop_path).forEach(item=>{
        container.appendChild(makeCard(item, forceTv));
      });
      revealObserve(container);
    }

    /* ===== SEARCH (debounced) ===== */
    let t;
    searchInput.addEventListener("input", ()=>{
      clearTimeout(t);
      const q = searchInput.value.trim();
      if(!q){ searchWrap.style.display="none"; results.innerHTML=""; return; }
      t = setTimeout(()=> doSearch(q), 260);
    });
    async function doSearch(q){
      searchWrap.style.display="block"; results.innerHTML="";
      const r = await fetch(`https://api.themoviedb.org/3/search/multi?include_adult=false&api_key=${API_KEY}&query=${encodeURIComponent(q)}`);
      const j = await r.json();
      (j.results||[]).filter(x=>x.poster_path).forEach(item=>{
        const type = item.media_type==="tv" ? "tv" : "movie";
        const el = document.createElement("div");
        el.className = "result-card reveal";
        el.innerHTML = `
          <img class="result-img" loading="lazy" src="${IMG.w500 + item.poster_path}" alt="${item.title||item.name}">
          <div class="result-meta">
            <div class="result-title">${item.title||item.name}</div>
            <div class="result-sub">${type.toUpperCase()} • ${(item.release_date||item.first_air_date||"").slice(0,4)}</div>
          </div>`;
        el.addEventListener("click", ()=> goWatch(item.id, type));
        results.appendChild(el);
      });
      revealObserve(results);
    }

    /* ===== CONTINUE WATCHING ===== */
    function getProgressMap(){ try{ return JSON.parse(localStorage.getItem("fk-continue")||"{}"); }catch{ return {}; } }
    async function buildContinue(){
      const map = getProgressMap();
      const keys = Object.keys(map).filter(k=> map[k] && map[k].progress < 98);
      if(!keys.length){ continueSection.style.display="none"; return; }
      continueSection.style.display="block";
      continueRail.innerHTML = "";
      for(const k of keys){
        const { id, type, progress } = map[k];
        try{
          const url = type==="tv" ? `https://api.themoviedb.org/3/tv/${id}?api_key=${API_KEY}` : `https://api.themoviedb.org/3/movie/${id}?api_key=${API_KEY}`;
          const d = await fetch(url).then(r=>r.json());
          if(d && (d.poster_path||d.backdrop_path)){
            const item = { id, media_type:type, title:d.title||d.name, poster_path:d.poster_path||d.backdrop_path, vote_average:d.vote_average, release_date:d.release_date, first_air_date:d.first_air_date };
            const c = makeCard(item, type==="tv", Math.round(progress));
            continueRail.appendChild(c);
          }
        }catch{}
      }
      revealObserve(continueRail);
    }

    /* ===== INIT ===== */
    (async function init(){
      await setHero();
      fillRow(row1, endpoints.trending);
      fillRow(row2, endpoints.topRated);
      fillRow(row3, endpoints.action);
      fillRow(row4, endpoints.comedy);
      fillRow(row5, endpoints.tvPopular, true);
      buildContinue();
      revealObserve(document);
    })();
  </script>
</body>
</html>
